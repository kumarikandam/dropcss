#!/usr/bin/env node
'use strict';
const fs = require('fs');             function q(){var a={description:"Remove unused CSS",example:"dropcss index.html example.html -c style.css -o style-dropped.css",line:"dropcss input.html[,n.html,...] -c style.css [-o output] [-hv]",usage:u()};const {usage:b={},description:c,line:d,example:e}=a;a=Object.keys(b);const g=Object.values(b),[f]=a.reduce(([h=0,m=0],p)=>{const r=b[p].split("\n").reduce((n,t)=>t.length>n?t.length:n,0);r>m&&(m=r);p.length>h&&(h=p.length);return[h,m]},[]),k=(h,m)=>{m=" ".repeat(m-h.length);return`${h}${m}`};
a=a.reduce((h,m,p)=>{p=g[p].split("\n");m=k(m,f);const [r,...n]=p;m=`${m}\t${r}`;const t=k("",f);p=n.map(y=>`${t}\t${y}`);return[...h,m,...p]},[]).map(h=>`\t${h}`);const l=[c,`  ${d||""}`].filter(h=>h?h.trim():h).join("\n\n");a=`${l?`${l}\n`:""}
${a.join("\n")}
`;return e?`${a}
  Example:

    ${e}
`:a};const v=(a,b,c,d=!1,e=!1)=>{const g=c?new RegExp(`^-(${c}|-${b})`):new RegExp(`^--${b}`);b=a.findIndex(f=>g.test(f));if(-1==b)return{argv:a};if(d)return{value:!0,argv:[...a.slice(0,b),...a.slice(b+1)]};d=b+1;c=a[d];if(!c||"string"==typeof c&&c.startsWith("--"))return{argv:a};e&&(c=parseInt(c,10));return{value:c,argv:[...a.slice(0,b),...a.slice(d+1)]}},w=a=>{const b=[];for(let c=0;c<a.length;c++){const d=a[c];if(d.startsWith("-"))break;b.push(d)}return b},u=()=>{var a=x;return Object.keys(a).reduce((b,
c)=>{const d=a[c];if("string"==typeof d)return b[`-${d}`]="",b;c=d.command?c:`--${c}`;d.short&&(c=`${c}, -${d.short}`);let e=d.description;d.default&&(e=`${e}\nDefault: ${d.default}.`);b[c]=e;return b},{})};const {readFileSync:z,writeFileSync:A}=fs;function B(a,b,c){throw Error(a+' parser stopped here: "'+b.substring(c,c+100)+'"');};const C=new Set("area base br col command embed hr img input keygen link meta param source track wbr".split(" ")),D=/<!doctype[^>]*>|\x3c!--[\s\S]*?--\x3e|<script[^>]*>[\s\S]*?<\/script>|<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>|<meta[^>]*>/gmi,E={u:/\s*<([\w-]+)\s*/myi,b:/\s*([\w-:]+)(?:="([^"]*)"|='([^']*)'|=([\w-]+))?\s*/myi,A:/\s*(\/?>)\s*/myi,B:/\s*[^<]*/my,m:/\s*<\/[\w-]+>\s*/myi};
function F(a){function b(l){d=l.lastIndex;for(let h in E)E[h].lastIndex=d}function c(){e=E.m.exec(a);if(null!=e)b(E.m),f.push(3);else if(e=E.u.exec(a),null!=e){b(E.u);let l=e[1];f.push(1,l);let h;for(;null!==(g=E.b.exec(a));)b(E.b),h=h||new Map,h.set(g[1],(g[2]||g[3]||g[4]||"").trim());h&&f.push(2,h);g=E.A.exec(a);(C.has(l)||"/>"==g[1])&&f.push(3);b(E.A)}else e=E.B.exec(a),null!=e&&b(E.B)}let d=0,e,g,f=[],k=d;for(;d<a.length;)c(),k===d&&B("html",a,d),k=d;b({lastIndex:0});return f}const G=new Set;
function H(a,b,c){return{tagName:b,attributes:c,classList:null!=c&&c.has("class")?new Set(c.get("class").split(/\s+/g)):G,parentNode:a,childNodes:[]}}const aa=[];function I(a,b){if(null!=a){let c=a.D=a.D||{};if(!(b in c)){let d=0;c[b]=a.childNodes.filter(e=>{if(e.tagName==b)return e.h=d++,!0})}return c[b]}return aa}
function ba(a,b){let c=H(null,"root",G),d;for(let e=0;e<a.length;e++)switch(a[e]){case 1:{let g=a[++e],f=G;2===a[e+1]&&(e+=2,f=a[e]);d=c.childNodes.length;c.childNodes.push(c=H(c,g,f));b(c,d);break}case 3:c=c.parentNode}}function ca(a,b,c){a.a=b;b=a.attributes;c.tag.add(a.tagName);a.classList.forEach(d=>c.C.add(d));b.has("id")&&c.i.add("[id="+b.get("id")+"]");b.has("type")&&c.i.add("[type="+b.get("type")+"]");c.j.push(a)}
function da(a){a=a.replace(D,"");a=F(a);const b={j:[],tag:new Set(["*"]),C:new Set,i:new Set};ba(a,(c,d)=>ca(c,d,b));return b};const ea=/\s*\/\*[\s\S]*?\*\/\s*/gm,fa=/\s*[>~+.#]\s*|\[[^\]]+\]|\s+/gm;function ha(a){a=a.split(/\s*,\s*/gm);a.push(a.map(b=>ia(b).trim().replace(fa,(c,d)=>{c=c.trim();return 0==d?c:"."==c||"#"==c?"`"+c:1>=c.length?"`":"`"+c.replace(/['"]/gm,"")}).split(/`+/gm)));return a}const ja=/:[a-z-]+\([^()]*\)/;function ia(a){let b=a.length;for(;;){a=a.replace(ja,"");if(a.length==b)break;b=a.length}return a.replace(/:?:[a-z-]+/gm,"")}
function J(a,b,c,d){let e="",g=1;for(;;){a[b]==c?g++:a[b]==d&&g--;if(0==g)break;e+=a[b++]}return e}
function ka(a){function b(h){g=h.lastIndex;for(let m in d)d[m].lastIndex=g}function c(){if(0<e&&(f=d.l.exec(a),null!=f)){e--;k.push(2);b(d.l);return}f=d.v.exec(a);if(null!=f){let h=f[1];b(d.v);if("@"==h[0])switch(h.match(/@[a-z-]+/)[0]){case "@media":case "@supports":case "@document":e++;k.push(1,h);break;case "@import":case "@charset":case "@namespace":k.push(5,h+";");break;default:{e++;let m=J(a,g,"{","}");b({lastIndex:g+m.length});k.push(1,h,5,m)}}else k.push(3,ha(f[1])),f=d.w.exec(a),k.push(4,
f[1]),b(d.w)}else g=a.length}const d={v:/\s*([^{;]+?)\s*[{;]\s*/my,w:/\s*([^}]*?)\s*\}/my,l:/\s*\}/my,F:/\s*([^{]*?)\{([^}]+?)\}/my};let e=0,g=0,f,k=[],l=g;for(;g<a.length;)c(),l===g&&B("css",a,g),l=g;return k}function la(a){a=a.replace(ea,"");return ka(a)}
function ma(a,b){let c="",d=0;for(let e=0;e<a.length;e++)switch(a[e]){case 3:{let g=a[++e];d=g.length;0<d&&(g.forEach(f=>b.add(f)),c+=g.join());break}case 4:0<d&&(c+="{"+a[++e]+"}");break;case 1:c+=a[++e]+"{";break;case 2:c+="}";break;case 5:c+=a[++e]}return c.replace(/@[a-z-]+[^{]+\{\s*\}/gm,"")};function na(a,b,c){if(0>b&&0>=a)return!1;if(-1===a)return c<=b;if(0===a)return c===b;if(1===a)return 0>b||c>=b;let d=b%a;0>d&&(d+=a);return 1<a?c>=b&&c%a===d:c<=b&&c%(-1*a)===d};function K(a){function b(l){e=l.lastIndex;for(let h in d)d[h].lastIndex=e}function c(){let l=!1;if(f=d.o.exec(a)){l=!0;var h=f[0].trim();""==h&&(h=" ");g.push(h);b(d.o);k=g.length-1}else if(f=d.s.exec(a))if(l=!0,h=f[0].trim(),b(d.s),":"==h){f=d.c.exec(a);if("("==f[2]){let m=J(a,d.c.lastIndex,"(",")");d.c.lastIndex+=m.length+1;f[2]="not"==f[1]?K(m):m}g.splice(k+1,0,f[2],f[1],h);b(d.c)}else"["==h?(f=d.b.exec(a),g.splice(k+1,0,f[3],f[2],f[1],h),b(d.b)):(f=d.g.exec(a),g.push(f[1],h),b(d.g));else if(f=
d.g.exec(a))l=!0,g.push(f[1],"_"),b(d.g);return l}const d={g:/([\w*-]+)/iy,b:/([\w-]+)(?:(.?=)["']?([^\]]*?)["']?)?\]/iy,c:/([\w-]+)(\()?/iy,s:/\s*[:.#\[]\s*/iy,o:/\s*[>~+]\s*|\s+/iy};let e=0,g=[],f,k=-1;for(;e<a.length;)c();return g}const oa=/^([+-]?\d*)?n([+-]\d+)?$/;function L(a,b,c,d){d=d||"=";a=a.attributes;if(a.has(b))switch(b=a.get(b),d){case "=":return null==c||c==b;case "*=":return-1!=b.indexOf(c);case "^=":return b.startsWith(c);case "$=":return b.endsWith(c);case "~=":return c==b||b.startsWith(c+" ")||b.endsWith(" "+c)||-1!=b.indexOf(" "+c+" ")}return!1}
function M(a,b){if("odd"==b)a=1==a%2;else if("even"==b)a=0==a%2;else if(/^\d+$/.test(b))a=a==+b;else{var c=oa.exec(b);null!=c?(b=c[1],c=c[2],b=null==b||"+"==b?1:"-"==b?-1:+b,c=null==c?0:+c,b=[b,c]):b=[0,0];a=na(b[0],b[1],a)}return a}
function N(a,b){let c,d;for(;-1<b.a;){switch(a[b.a]){case "_":var e=a[--b.a];d=e==b.node.tagName||"*"==e;b.a--;break;case "#":var g=a[--b.a];d=L(b.node,"id",g,"=");b.a--;break;case ".":e=a[--b.a];d=b.node.classList.has(e);b.a--;break;case "[":e=a[--b.a];var f=a[--b.a];g=a[--b.a];d=L(b.node,e,g,f);b.a--;break;case ":":{e=a[--b.a];g=a[--b.a];let k=b.node,l=k.tagName;c=k.a;let h=(f=k.parentNode)?f.childNodes.length:1;switch(e){case "not":d=!N(g,{node:b.node,a:g.length-1});break;case "first-child":d=
0==c;break;case "last-child":d=c==h-1;break;case "only-child":d=1==h;break;case "nth-child":d=M(c+1,g);break;case "nth-last-child":d=M(h-c,g);break;case "first-of-type":I(f,l);d=0==k.h;break;case "last-of-type":e=I(f,l);d=k.h==e.length-1;break;case "only-of-type":e=I(f,l);d=1==e.length;break;case "nth-of-type":I(f,l);d=M(k.h+1,g);break;case "nth-last-of-type":e=I(f,l),d=M(e.length-k.h,g)}b.a--;break}case " ":c=--b.a;for(d=!1;!d;){f=b.node.parentNode;if(null==f)break;b.a=c;b.node=f;d=N(a,b)}break;
case ">":b.a--;f=b.node.parentNode;null!=f?(b.node=f,d=N(a,b)):d=!1;break;case "+":b.a--;f=b.node.parentNode;null!=f&&0<b.node.a?(b.node=f.childNodes[b.node.a-1],d=N(a,b)):d=!1;break;case "~":if(b.a--,d=!1,c=b.node.a,f=b.node.parentNode,null!=f&&0<c)for(g=0;g<c&&!d;g++)b.node=f.childNodes[g],d=N(a,b)}if(!d)break}return d}function pa(a,b){return a.some(c=>N(b,{a:b.length-1,node:c}))};function O(a,b,c,d,e){e=e||"";for(let k=b.length-1;-1<k;k--){var g=b[k];if(!c.has(g[2])&&!0===d(e+g[2])){var f=g[0];g=g[1];a=a.slice(0,f)+""+a.slice(f+g)}}return a}const P=/([{};])\s*(--[\w-]+)\s*:\s*([^;}]+);?\s*/gm,Q=/var\(([\w-]+)\)/gm,R=/\s*,\s*/gm;function qa(a){let b={},c;for(;Q.test(a);){for(;null!==(c=P.exec(a));)b[c[2]]=c[3];a=a.replace(Q,(d,e)=>Q.test(b[e])?d:b[e])}return a}
function ra(a,b,c){let d=[];var e=/@(?:-\w+-)?keyframes\s+([\w-]+)\s*\{/gm;let g;for(;null!==(g=e.exec(a));)d.push([g.index,g[0].length+J(a,e.lastIndex,"{","}").length+1,g[1]]);let f=new Set;for(e=/animation(?:-name)?:([^;!}]+)/gm;null!==(g=e.exec(b));)g[1].trim().split(R).forEach(k=>{let l=k.match(/^\S+/)[0];/^-?[\d.]+m?s/.test(l)&&(l=k.match(/\S+$/)[0]);f.add(l)});return O(a,d,f,c,"@keyframes ")}function S(a){return a.trim().replace(/'|"/gm,"").split(R)}
function sa(a,b,c){var d=/@font-face[^}]+\}+/gm;let e,g=[];for(;null!==(e=d.exec(a));)g.push([e.index,e[0].length]);for(var f=/font-family:([^;!}]+)/,k,l=0;null!==(e=d.exec(b));)k=f.exec(e[0]),g[l++].push(S(k[1])[0]);let h=new Set;for(k=/@font-face[^}]+\}+|font-family:([^;!}]+)/gm;null!==(e=k.exec(b));)"@"!==e[0][0]&&S(e[1]).forEach(m=>h.add(m));d=/font:([^;!}]+)/gm;for(f=/\s*(?:['"][\w- ]+['"]|[\w-]+)\s*(?:,|$)/gm;null!==(e=d.exec(b));){for(l="";null!==(k=f.exec(e[1]));)l+=k[0];S(l).forEach(m=>h.add(m))}return O(a,
g,h,c,"@font-face ")}function ta(a){let b=a;do a=b,b=a.replace(P,(c,d,e)=>-1!=a.indexOf("var("+e+")")?c:d);while(b!=a);return b}function ua(a,b){let c=qa(a).replace(P,(d,e)=>e);a=ra(a,c,b);a=sa(a,c,b);a=ta(a);return a.replace(/[^{}]+\{\s*\}/gm,"")};/*

 MIT original package code dropcss
 2019 https://github.com/leeoniya/dropcss
*/
const va=/\[([\w-]+)(?:(.?=)"?([^\]]*?)"?)?\]/i,wa=/:(?:first|last|nth|only|not)\b/;function xa(a){return a.replace(/:?:[a-z-]+/gm,b=>b.startsWith("::")||!wa.test(b)?"":b).replace(/:[a-z-]+\(\)/gm,"")}const ya=()=>!0;
function T(a){const {html:b,shouldDrop:c=ya,css:d}=a,e=da(b);a=la(d);const g={};for(var f=0;f<a.length;f++){if(3!==a[f])continue;let l=a[f+1],h=l[l.length-1];f++;for(let m=0;m<h.length;m++){let p=h[m];a:for(let r=0;r<p.length;r++){let n=p[r];var k=!1;if(""!=n){if(n in g)k=g[n];else switch(n[0]){case "#":k=n.substr(1);g[n]=k=e.i.has("[id="+k+"]");break;case ".":k=n.substr(1);g[n]=k=e.C.has(k);break;case "[":if(n.startsWith("[type="))g[n]=k=e.i.has(n);else{let t=n.match(va);g[n]=k=e.j.some(y=>L(y,t[1],
t[3],t[2]))}break;default:g[n]=k=e.tag.has(n)}if(!k){!0===c(l[m])?l[m]=null:g[l[m]]=!0;break a}}}}}for(f=0;f<a.length;f++)3===a[f]&&(f++,a[f]=a[f].filter(l=>{if("string"==typeof l){if(l in g)return g[l];let h=xa(l);return""==h?!0:h in g?g[h]:g[h]=pa(e.j,Array.isArray(h)?h:K(h))||!0!==c(l)}return!1}));f=new Set;a=ma(a,f);a=ua(a,c);return{css:a.replace(/@[a-z-]+[^{]+\{\s*\}/gm,""),sels:f}};const x={input:{description:"The HTML files to read.",command:!0,multiple:!0},css:{description:"The CSS file to drop selectors from.",short:"c"},output:{description:"The destination where to save output.\nIf not passed, prints to stdout.",short:"o"},help:{description:"Print the help information and exit.",boolean:!0,short:"h"},version:{description:"Show the version's number and exit.",boolean:!0,short:"v"}},U=function(a={},b=process.argv){[,,...b]=b;const c=w(b);b=b.slice(c.length);let d=!c.length;
return Object.keys(a).reduce(({f:e,...g},f)=>{if(0==e.length&&d)return{f:e,...g};const k=a[f];let l;if("string"==typeof k)({value:l,argv:e}=v(e,f,k));else try{const {short:h,boolean:m,number:p,command:r,multiple:n}=k;r&&n&&c.length?(l=c,d=!0):r&&c.length?(l=c[0],d=!0):{value:l,argv:e}=v(e,f,h,m,p)}catch(h){return{f:e,...g}}return void 0===l?{f:e,...g}:{f:e,...g,[f]:l}},{f:b})}(x),za=U.input,V=U.css,W=U.output,Aa=U.version;/*

 TrapCSS: Remove unused CSS selectors based on HTML files.

 Copyright (C) 2019 Art Deco

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as
 published by the Free Software Foundation, either version 3 of the
 License, or (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/
if(U.help){const a=q();console.log(a)}else Aa&&console.log(require("../../package.json").version);V||(console.error("Please pass CSS path"),process.exit(1));const X=z(V,"utf8");let Y=new Set;za.forEach(a=>{a=z(a,"utf8");({sels:a}=T({css:X,html:a}));a.forEach(b=>Y.add(b))});const Z=T({html:"",css:X,shouldDrop:a=>!Y.has(a)});W?(A(W,Z.css),console.error("Output written to %s",W)):console.log(Z.css);

//# sourceMappingURL=trapcss.js.map